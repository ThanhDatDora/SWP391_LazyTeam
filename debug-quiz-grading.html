<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Debug Quiz Grading Logic</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-case {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question {
      font-weight: bold;
      margin: 10px 0;
    }
    .option {
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .correct { background: #d4edda; border-color: #28a745; }
    .wrong { background: #f8d7da; border-color: #dc3545; }
    .selected { border-width: 2px; font-weight: bold; }
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
    }
    .pass { background: #d4edda; color: #155724; }
    .fail { background: #f8d7da; color: #721c24; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover { background: #0056b3; }
    pre {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>üß™ Debug Quiz Grading Logic</h1>
  
  <div id="test-container"></div>

  <script>
    // Sample quiz data from your lesson
    const quizData = {
      "type": "quiz",
      "quiz_id": null,
      "description": "Ki·ªÉm tra ki·∫øn th·ª©c v·ªÅ MOOC 2",
      "timeLimit": 10,
      "passingScore": 70,
      "questions": [
        {
          "id": 1,
          "question": "C√¢u h·ªèi 1: ƒê√¢y l√† c√¢u h·ªèi g√¨?",
          "options": ["ƒê√°p √°n A - Sai", "ƒê√°p √°n B - Sai", "ƒê√°p √°n C - ƒê√∫ng", "ƒê√°p √°n D - Sai"],
          "correctAnswer": 2
        }
      ]
    };

    // QuizLesson.jsx grading logic (lines 69-77)
    function calculateScore(questions, selectedAnswers) {
      let correctCount = 0;
      questions.forEach(q => {
        console.log(`Question ${q.id}:`, {
          userAnswer: selectedAnswers[q.id],
          correctAnswer: q.correctAnswer,
          isCorrect: selectedAnswers[q.id] === q.correctAnswer
        });
        
        if (selectedAnswers[q.id] === q.correctAnswer) {
          correctCount++;
        }
      });

      const percentage = (correctCount / questions.length) * 100;
      return { percentage, correctCount, total: questions.length };
    }

    function runTest(testName, selectedAnswers, expected) {
      console.log(`\nüß™ Test: ${testName}`);
      const result = calculateScore(quizData.questions, selectedAnswers);
      
      const testDiv = document.createElement('div');
      testDiv.className = 'test-case';
      
      let html = `<h3>${testName}</h3>`;
      
      quizData.questions.forEach(q => {
        const userAnswer = selectedAnswers[q.id];
        const isCorrect = userAnswer === q.correctAnswer;
        
        html += `<div class="question">${q.question}</div>`;
        q.options.forEach((option, idx) => {
          let classes = ['option'];
          if (idx === q.correctAnswer) classes.push('correct');
          if (idx === userAnswer) {
            classes.push('selected');
            if (!isCorrect) classes.push('wrong');
          }
          
          html += `<div class="${classes.join(' ')}">
            ${idx === userAnswer ? 'üëâ ' : ''}
            ${idx === q.correctAnswer ? '‚úÖ ' : ''}
            [${idx}] ${option}
          </div>`;
        });
      });
      
      html += `<div class="result ${result.percentage >= quizData.passingScore ? 'pass' : 'fail'}">
        Score: ${result.percentage.toFixed(0)}% 
        (${result.correctCount}/${result.total} correct)
        ${result.percentage === expected ? '‚úÖ PASS' : '‚ùå FAIL'}
      </div>`;
      
      html += `<pre>Selected: ${JSON.stringify(selectedAnswers, null, 2)}
Expected: ${expected}%
Got: ${result.percentage}%</pre>`;
      
      testDiv.innerHTML = html;
      document.getElementById('test-container').appendChild(testDiv);
      
      return result.percentage === expected;
    }

    // Run tests
    console.log('üöÄ Starting quiz grading tests...');
    
    // Test 1: Select correct answer (index 2)
    runTest(
      'Test 1: Select CORRECT answer (index 2 - "ƒê√°p √°n C - ƒê√∫ng")',
      { 1: 2 },
      100
    );
    
    // Test 2: Select wrong answer (index 0)
    runTest(
      'Test 2: Select WRONG answer (index 0 - "ƒê√°p √°n A - Sai")',
      { 1: 0 },
      0
    );
    
    // Test 3: Select wrong answer (index 1)
    runTest(
      'Test 3: Select WRONG answer (index 1 - "ƒê√°p √°n B - Sai")',
      { 1: 1 },
      0
    );
    
    // Test 4: Select wrong answer (index 3)
    runTest(
      'Test 4: Select WRONG answer (index 3 - "ƒê√°p √°n D - Sai")',
      { 1: 3 },
      0
    );

    // Test with actual quiz data from console
    console.log('\nüìä Quiz Data Structure:');
    console.log('quizData:', quizData);
    console.log('correctAnswer type:', typeof quizData.questions[0].correctAnswer);
    console.log('correctAnswer value:', quizData.questions[0].correctAnswer);
  </script>
</body>
</html>
