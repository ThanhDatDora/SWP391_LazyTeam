<!DOCTYPE html>
<html>
<head>
    <title>Test Dashboard API</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .section { margin-bottom: 30px; }
        h2 { color: #333; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Dashboard API Test</h1>
    
    <div class="section">
        <h2>1. Test Stats API</h2>
        <button onclick="testStats()">Test /api/instructor/stats</button>
        <pre id="stats-result">Click button to test...</pre>
    </div>

    <div class="section">
        <h2>2. Test Courses API</h2>
        <button onclick="testCourses()">Test /api/instructor/courses</button>
        <pre id="courses-result">Click button to test...</pre>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001';
        
        // Get token from localStorage (same as main app)
        function getToken() {
            const authStr = localStorage.getItem('auth');
            if (authStr) {
                try {
                    const auth = JSON.parse(authStr);
                    return auth.token;
                } catch (e) {
                    return null;
                }
            }
            return null;
        }

        async function testStats() {
            const resultEl = document.getElementById('stats-result');
            resultEl.textContent = 'Loading...';
            
            try {
                const token = getToken();
                if (!token) {
                    resultEl.innerHTML = '<span class="error">No token found! Please login first.</span>';
                    return;
                }

                const response = await fetch(`${API_BASE}/api/instructor/stats`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                resultEl.innerHTML = `
<span class="success">✅ Response Status: ${response.status}</span>

<strong>Stats Data:</strong>
${JSON.stringify(data, null, 2)}

<strong>Total Students:</strong> ${data.data?.totalStudents || 'N/A'}
<strong>Total Courses:</strong> ${data.data?.totalCourses || 'N/A'}
<strong>Active Courses:</strong> ${data.data?.activeCourses || 'N/A'}
<strong>Avg Rating:</strong> ${data.data?.averageRating || 'N/A'}
                `.trim();
            } catch (error) {
                resultEl.innerHTML = `<span class="error">❌ Error: ${error.message}</span>`;
            }
        }

        async function testCourses() {
            const resultEl = document.getElementById('courses-result');
            resultEl.textContent = 'Loading...';
            
            try {
                const token = getToken();
                if (!token) {
                    resultEl.innerHTML = '<span class="error">No token found! Please login first.</span>';
                    return;
                }

                const response = await fetch(`${API_BASE}/api/instructor/courses`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                const courses = data.data || [];
                const courseList = courses.map(c => 
                    `Course ${c.course_id}: ${c.total_students} students | Status: ${c.status}`
                ).join('\n');

                resultEl.innerHTML = `
<span class="success">✅ Response Status: ${response.status}</span>

<strong>Total Courses:</strong> ${courses.length}

<strong>Courses:</strong>
${courseList}

<strong>Full Response:</strong>
${JSON.stringify(data, null, 2)}
                `.trim();
            } catch (error) {
                resultEl.innerHTML = `<span class="error">❌ Error: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>
