<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Cart - Mini Coursera</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #14b8a6;
            border-bottom: 2px solid #14b8a6;
            padding-bottom: 10px;
        }
        button {
            background: #14b8a6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #0d9488;
        }
        button.danger {
            background: #ef4444;
        }
        button.danger:hover {
            background: #dc2626;
        }
        pre {
            background: #1e293b;
            color: #10b981;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
        }
        .info {
            padding: 10px;
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            margin: 10px 0;
        }
        .success {
            padding: 10px;
            background: #d1fae5;
            border-left: 4px solid #10b981;
            margin: 10px 0;
        }
        .error {
            padding: 10px;
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üõí Debug Gi·ªè H√†ng - Mini Coursera</h1>

    <div class="section">
        <h2>üìä Tr·∫°ng th√°i hi·ªán t·∫°i</h2>
        <div id="status"></div>
        <button onclick="checkStatus()">üîÑ Refresh Status</button>
    </div>

    <div class="section">
        <h2>‚ûï Th√™m item test</h2>
        <button onclick="addTestItem()">Th√™m kh√≥a h·ªçc test</button>
        <button onclick="addMultipleItems()">Th√™m 3 kh√≥a h·ªçc</button>
        <div id="addResult"></div>
    </div>

    <div class="section">
        <h2>üëÄ Xem d·ªØ li·ªáu</h2>
        <button onclick="viewCart()">Xem gi·ªè h√†ng</button>
        <button onclick="viewAllLocalStorage()">Xem t·∫•t c·∫£ localStorage</button>
        <div id="viewResult"></div>
    </div>

    <div class="section">
        <h2>üóëÔ∏è X√≥a d·ªØ li·ªáu</h2>
        <button class="danger" onclick="clearCart()">X√≥a gi·ªè h√†ng</button>
        <button class="danger" onclick="clearAllLocalStorage()">X√≥a to√†n b·ªô localStorage</button>
        <div id="clearResult"></div>
    </div>

    <div class="section">
        <h2>üß™ Test localStorage</h2>
        <button onclick="testLocalStorageWrite()">Test ghi localStorage</button>
        <button onclick="testLocalStorageRead()">Test ƒë·ªçc localStorage</button>
        <button onclick="testLocalStoragePersist()">Test persistence (reload page)</button>
        <div id="testResult"></div>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            element.innerHTML = `<div class="${className}">${message}</div>`;
        }

        function checkStatus() {
            const cart = localStorage.getItem('cart');
            const cartData = cart ? JSON.parse(cart) : [];
            const itemCount = cartData.length;
            const totalPrice = cartData.reduce((sum, item) => sum + (item.price || 0), 0);
            
            const html = `
                <div class="info">
                    <strong>üì¶ S·ªë l∆∞·ª£ng items:</strong> ${itemCount}<br>
                    <strong>üí∞ T·ªïng gi√°:</strong> ${totalPrice.toLocaleString('vi-VN')} VNƒê<br>
                    <strong>üìÖ Th·ªùi gian:</strong> ${new Date().toLocaleString('vi-VN')}
                </div>
                <pre>${cart || 'Gi·ªè h√†ng tr·ªëng'}</pre>
            `;
            log('status', html);
        }

        function addTestItem() {
            try {
                const cart = localStorage.getItem('cart');
                const cartData = cart ? JSON.parse(cart) : [];
                
                const newItem = {
                    id: Date.now(),
                    title: `Kh√≥a h·ªçc test ${cartData.length + 1}`,
                    price: Math.floor(Math.random() * 500000) + 100000,
                    instructorName: 'Test Instructor',
                    thumbnail: `https://picsum.photos/400/250?random=${Date.now()}`,
                    level: 'Beginner',
                    duration: '10h'
                };
                
                cartData.push(newItem);
                localStorage.setItem('cart', JSON.stringify(cartData));
                
                log('addResult', `‚úÖ ƒê√£ th√™m: ${newItem.title} (${newItem.price.toLocaleString('vi-VN')} VNƒê)`, 'success');
                checkStatus();
            } catch (error) {
                log('addResult', `‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        function addMultipleItems() {
            try {
                const items = [
                    { id: 1, title: 'React Advanced', price: 299000, instructorName: 'John Doe', level: 'Advanced', duration: '15h' },
                    { id: 2, title: 'Node.js Master', price: 399000, instructorName: 'Jane Smith', level: 'Intermediate', duration: '20h' },
                    { id: 3, title: 'TypeScript Pro', price: 199000, instructorName: 'Mike Wilson', level: 'Beginner', duration: '12h' }
                ];
                
                localStorage.setItem('cart', JSON.stringify(items));
                log('addResult', `‚úÖ ƒê√£ th√™m ${items.length} kh√≥a h·ªçc`, 'success');
                checkStatus();
            } catch (error) {
                log('addResult', `‚ùå L·ªói: ${error.message}`, 'error');
            }
        }

        function viewCart() {
            const cart = localStorage.getItem('cart');
            if (!cart) {
                log('viewResult', '‚ö†Ô∏è Gi·ªè h√†ng tr·ªëng', 'info');
                return;
            }
            
            try {
                const cartData = JSON.parse(cart);
                const html = `<pre>${JSON.stringify(cartData, null, 2)}</pre>`;
                log('viewResult', html);
            } catch (error) {
                log('viewResult', `‚ùå L·ªói parse: ${error.message}`, 'error');
            }
        }

        function viewAllLocalStorage() {
            const items = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                items[key] = localStorage.getItem(key);
            }
            const html = `<pre>${JSON.stringify(items, null, 2)}</pre>`;
            log('viewResult', html);
        }

        function clearCart() {
            localStorage.removeItem('cart');
            log('clearResult', '‚úÖ ƒê√£ x√≥a gi·ªè h√†ng', 'success');
            checkStatus();
        }

        function clearAllLocalStorage() {
            const confirmed = confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a TO√ÄN B·ªò localStorage? (bao g·ªìm c·∫£ token ƒëƒÉng nh·∫≠p)');
            if (confirmed) {
                localStorage.clear();
                log('clearResult', '‚úÖ ƒê√£ x√≥a to√†n b·ªô localStorage', 'success');
                checkStatus();
            }
        }

        function testLocalStorageWrite() {
            try {
                const testData = { test: true, timestamp: Date.now() };
                localStorage.setItem('test_key', JSON.stringify(testData));
                log('testResult', '‚úÖ Ghi localStorage th√†nh c√¥ng!', 'success');
            } catch (error) {
                log('testResult', `‚ùå Kh√¥ng th·ªÉ ghi localStorage: ${error.message}`, 'error');
            }
        }

        function testLocalStorageRead() {
            try {
                const testData = localStorage.getItem('test_key');
                if (testData) {
                    log('testResult', `‚úÖ ƒê·ªçc th√†nh c√¥ng: <pre>${testData}</pre>`, 'success');
                } else {
                    log('testResult', '‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y test_key. Ch·∫°y "Test ghi" tr∆∞·ªõc!', 'info');
                }
            } catch (error) {
                log('testResult', `‚ùå Kh√¥ng th·ªÉ ƒë·ªçc localStorage: ${error.message}`, 'error');
            }
        }

        function testLocalStoragePersist() {
            const testData = { 
                test: true, 
                timestamp: Date.now(),
                message: 'N·∫øu th·∫•y d·ªØ li·ªáu n√†y sau khi reload, localStorage ho·∫°t ƒë·ªông t·ªët!'
            };
            localStorage.setItem('persist_test', JSON.stringify(testData));
            log('testResult', '‚úÖ ƒê√£ l∆∞u d·ªØ li·ªáu test. Reload trang n√†y v√† click "Test ƒë·ªçc" ƒë·ªÉ ki·ªÉm tra!', 'success');
        }

        // Auto check status on load
        window.onload = checkStatus;
    </script>
</body>
</html>
